{"version":3,"sources":["components/AlbumCard/AlbumCard.js","components/AlbumList/AlbumList.js","components/Splashscreen/Splashscreen.js","components/Welcome/Welcome.js","components/AlbumView/AlbumView.js","App.js","index.js"],"names":["AlbumCard","props","id","name","image","popularity","getAlbumTracks","onClick","className","src","alt","AlbumList","userAlbums","useEffect","console","log","popColor","pops","document","getElementsByClassName","i","length","score","Number","innerHTML","style","color","display","flexWrap","justifyContent","map","album","Splashscreen","clientId","redirect","window","location","replace","Welcome","userProfileUrl","userDisplayName","AlbumView","loadedAlbum","clearAlbum","item","App","useState","code","setCode","token","setToken","setRefreshToken","setExpiry","setRequestTime","setUserDisplayName","setUserProduct","setUserProfileUrl","setUserAlbums","setLoadedAlbum","GEToptions","inputToken","method","headers","particlesConfig","require","search","parseUrl","recievedCode","URLSearchParams","get","getAccessToken","a","fetch","body","JSON","stringify","rawResponse","json","response","Date","expires_in","access_token","refresh_token","getUserDataOnInit","e","user","display_name","product","external_urls","spotify","getUserAlbums","allAlbums","offset","albums","items","concat","handleAlbums","rawAlbumList","albumList","images","url","albumId","rawTracks","tracks","track","duration_ms","link","getElementsByTagName","overflow","classList","add","params","remove","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b42b706e.chunk.js","sourcesContent":["import React from 'react';\n\nconst AlbumCard = (props) => {\n\nconst { id, name, image, popularity, getAlbumTracks } = props\n\n  return(\n    <div onClick={()=>{getAlbumTracks(id)}} className=\"grow br2 ba dark-gray b--black-10 mv2 mv4-ns w-50 ma3-ns w-20-ns center\">\n      <img  src={image} className=\"db w-100 br2 br--top\" alt=\"Album art\"/>\n      <div className=\"pa2 ph3-ns pb3-ns\">\n        <div className=\"dt w-100 mt1\">\n          <div className=\"dtc w-90\">\n            <h1 className=\"f5 f4-ns mv0 white\">{name}</h1>\n          </div>\n          <div className=\"dtc tr w-10\">\n            <h2 className=\"f5 mv0 popularity\">{popularity}</h2>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default AlbumCard\n","import { React, useEffect } from 'react';\nimport AlbumCard from '../AlbumCard/AlbumCard.js';\nimport './AlbumList.css';\n\nconst AlbumList = (props) => {\n\nconst { userAlbums, getAlbumTracks} = props;\n\nuseEffect(()=>{\n  console.log('useeffect ran on album list')\n  if (userAlbums){popColor()}\n})\n\n//run through the album cards and set the color of the popularity text based on score\nconst popColor = () => {\n  //set thresholds\n  const high = 75\n  const low = 25\n  let pops = document.getElementsByClassName('popularity')\n\n  for (let i=0; i<pops.length; i++){\n    let score = Number(pops[i].innerHTML)\n    if (score >= high){pops[i].style.color = \"green\"}\n    else if (score >= low){pops[i].style.color = \"darkorange\"}\n    else {pops[i].style.color = \"red\"}  \n  }\n}\n\n//if there are albums loaded, loop through them and display a card for each\n//if not, do nothing\nif (userAlbums) {\n    return(\n        <div className={`album-list animate`} style={{display: 'flex',flexWrap: 'wrap',justifyContent: 'space-around'}}>\n            {userAlbums.map(album => {\n                return <AlbumCard key={album.id} id={album.id} name={album.name} image={album.image} popularity={album.popularity} getAlbumTracks={getAlbumTracks}/>\n            })}\n            \n        </div>\n        \n    )\n} else {\n    return(null)\n  } \n}\n\nexport default AlbumList","import React from 'react';\n\nconst Splashscreen = (props) => {\n\nconst { clientId, redirect } = props\n\n  return(\n    <div className=\"App\">\n        <button style={{'margin': '10%'}} onClick={()=>window.location.replace(`https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=code&redirect_uri=${redirect}&show_dialog=false&scope=user-read-private%20user-library-read`)}>Connect to Spotify!</button>\n    </div>\n  )\n}\n\nexport default Splashscreen\n","import React from 'react';\nimport './Welcome.css'\n\n\n\nconst Welcome = (props) => {\n\n  // eslint-disable-next-line\n  const { userProfileUrl, userDisplayName } = props\n\n  return(\n      <div className='welcome'>\n        <h1 className={'fade-in'}>\n          Welcome, {userDisplayName}.<br />\n        </h1>\n      </div>\n  )\n}\n\nexport default Welcome","import React from 'react';\nimport './AlbumView.css';\n\nconst AlbumView = (props) => {\n  \nconst { loadedAlbum, clearAlbum } = props\n\n  return (\n    <div className=\"album-tracks\">\n      <div className={'track text-center grow'} onClick={clearAlbum}>\n        BACK\n      </div>\n      \n      {loadedAlbum.map(item => {\n        return <div key={item.id} className='track text-center grow'>\n                {item.name}  <br />\n               </div>\n      })}\n      \n    </div>\n  )\n\n}\n\nexport default AlbumView","import { useState, useEffect } from 'react';\nimport AlbumList from './components/AlbumList/AlbumList.js';\nimport Splashscreen from './components/Splashscreen/Splashscreen.js';\nimport Welcome from './components/Welcome/Welcome.js';\nimport AlbumView from './components/AlbumView/AlbumView.js'\nimport Particles from 'react-particles-js';\nimport './App.css';\nimport 'tachyons';\n\nconst clientId = 'ebcbc13ca3b34ed6a4cf0bf4d7579df9';\nconst redirect = 'https%3A%2F%2Fwww.jamescockayne.co.uk%2Fspotify-app%2F';\n\n\nconst App = () => {\n\n  //hooks for state\n  const [code, setCode] = useState(null)\n  const [token, setToken] = useState(null) // eslint-disable-next-line \n  const [refreshToken, setRefreshToken] = useState(null) // eslint-disable-next-line \n  const [expiry, setExpiry] = useState(null) // eslint-disable-next-line \n  const [requestTime, setRequestTime] = useState(null)\n  const [userDisplayName, setUserDisplayName] = useState('Loading...') // eslint-disable-next-line \n  const [userProduct, setUserProduct] = useState(null)\n  const [userProfileUrl, setUserProfileUrl] = useState(null)\n  const [userAlbums, setUserAlbums] = useState(null)\n  const [loadedAlbum, setLoadedAlbum] = useState([])\n\n  //global options parameter for GET requests, take a token, and return an object with the right header\n  //defaults to using the token from app state, but can be custom\n  const GEToptions = (inputToken = token) => {\n    return ({\n      method: 'GET',\n      headers: {'Authorization': `Bearer ${inputToken}`}\n    })\n  }\n\n  //parameters for the particles background\n  const particlesConfig = require('./particlesjs-config.json')\n\n  //request for the url to be parsed if there is a query string on page load\n  useEffect(() => {\n    (window.location.search !== \"\")?parseUrl():console.log('Please link with Spotify') // eslint-disable-next-line\n  },[])\n\n  //grab the code parameter from the query string and pass it to getAccessToken()\n  const parseUrl = () => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const recievedCode = urlParams.get('code')\n    setCode(recievedCode)\n    getAccessToken(recievedCode)\n  }\n\n  //send the code to the backend and update the state with the results\n  const getAccessToken = async (recievedCode) => {\n    let rawResponse = await fetch('https://spotify-test-project.herokuapp.com', {\n      method: 'POST',\n      headers: {'Content-Type': 'application/json'},\n      body: JSON.stringify({\n        code: recievedCode,\n        clientId: clientId,\n        redirect: redirect\n      })\n    })\n\n    let response = await rawResponse.json()\n\n    try {\n      setRequestTime(new Date())\n      setExpiry(response.expires_in)\n      setToken(response.access_token)\n      setRefreshToken(response.refresh_token) \n      //get the user's profile with the token we just recieved, because the default value of token here comes back as blank\n      getUserDataOnInit(response.access_token)  \n    } catch(e){console.log(e)}\n  }\n\n  //make a request for profile data and update state with basic details\n  const getUserDataOnInit = async (inputToken) => {\n    try {\n      let response = await fetch('https://api.spotify.com/v1/me', GEToptions(inputToken))\n      let user = await response.json()  \n      setUserDisplayName(user.display_name)\n      setUserProduct(user.product)\n      setUserProfileUrl(user.external_urls.spotify)\n      getUserAlbums(inputToken)\n    } catch(e){console.log(e)}  \n\n  }\n\n  const getUserAlbums = async (inputToken) => {\n    //start with no albums, and make the first request from offset=0\n    let allAlbums = []\n    let offset = 0\n\n    //spotify limits album requests to 50 at a time, so...\n    //if the number of albums recieved so far is a multiple of 50, make another request for the next 50, by specifying the offset\n    //Eventually the albums stop coming in 50s and we are done\n    //For the edge case that the final number required is a multiple of 50, we check if each batch is blank. If so, we are done. \n    while ((allAlbums.length % 50) === 0){\n      let response = await fetch(`https://api.spotify.com/v1/me/albums?offset=${offset}&limit=50`, GEToptions(inputToken))\n      let albums = await response.json()\n      if (albums.items.length === 0){break}\n      allAlbums = allAlbums.concat(albums.items)\n      offset += 50\n    } \n\n    //process the complete album list\n    handleAlbums(allAlbums)\n  }\n\n  const handleAlbums = (rawAlbumList) => {\n    let albumList = rawAlbumList.map(item => {\n      return {\n        name: item.album.name,\n        image: item.album.images[0].url,\n        popularity: item.album.popularity,\n        id: item.album.id\n      } \n    })\n    setUserAlbums(albumList)\n  }\n\n  const getAlbumTracks = async (albumId) => {\n    console.log('running getAlbumTracks()')\n    \n    //make the request for the album whose id has been passed\n    let response = await fetch(`https://api.spotify.com/v1/albums/${albumId}/tracks`, GEToptions())\n    let rawTracks = await response.json()\n\n    //process the response into a simpler array\n    let tracks = rawTracks.items.map(track => {\n      return {\n        name: track.name,\n        length: track.duration_ms,\n        id: track.id,\n        link: track.external_urls.spotify\n      }\n    })\n    setLoadedAlbum(tracks)\n    document.getElementsByTagName('body')[0].style.overflow = 'hidden' \n    document.getElementsByClassName('overlay')[0].classList.add('show')\n  }\n\n  //hide the overlay to go back to library view\n  const clearAlbum = () => {\n    document.getElementsByTagName('body')[0].style.overflow = 'visible'\n    document.getElementsByClassName('overlay')[0].classList.remove('show')\n  }\n\n  //if there is no code stored, then the user must have not have logged in, or has refused to grant access, so show them a 'connect' button\n  //else, they must have logged in, so show the app\n  return (\n    <div>\n      <Particles params={particlesConfig} className='particles'/>\n      {(code===null)\n        ? <Splashscreen clientId={clientId} redirect={redirect}/>\n        : <div className=\"App\">\n            <div className={'overlay hide'}>\n              <AlbumView loadedAlbum={loadedAlbum} clearAlbum={clearAlbum}/>\n            </div>\n            <Welcome userDisplayName={userDisplayName} userProfileUrl={userProfileUrl}/>\n            <AlbumList userAlbums={userAlbums} getAlbumTracks={getAlbumTracks}/>     \n          </div>     \n      }   \n    </div>\n  )  \n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}